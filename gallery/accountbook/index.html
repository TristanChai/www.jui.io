<!DOCTYPE HTML>
<html>
<head>
<title>JENNIFER UI: AdminTool Sample</title>
<link rel="stylesheet" href="/lib/jui/css/ui.min.css"/>
<link id="ui_theme" rel="stylesheet" href="/lib/jui/css/ui-jennifer.min.css"/>
<link rel="stylesheet" href="/lib/jui/css/grid.min.css"/>
<link id="grid_theme" rel="stylesheet" href="/lib/jui/css/grid-jennifer.min.css"/>
<script src="/lib/jquery-1.8.0.min.js"></script>
<script src="/lib/jui/js/core.min.js"></script>
<script src="/lib/jui/js/ui.min.js"></script>
<script src="/lib/jui/js/grid.min.js"></script>
<script src="/lib/jui/js/chart.min.js"></script>
<script src="/gallery/accountbook/data.js"></script>
<link href="/gallery/accountbook/index.css" rel="stylesheet" type="text/css" />

<script>
function printStartToEndDate(month) {
	var _ = jui.include("util.base");

	var now = new Date(),
		start = new Date(now.getFullYear(), month || now.getMonth(), 1),
		end = new Date(start.getFullYear(), start.getMonth() + 1, 1);

	start.setDate(1);
	end = new Date(end.getTime() - 1);

	$(".header .start-date").html(_.dateFormat(start, "yyyy.MM.dd"));
	$(".header .end-date").html(_.dateFormat(end, "yyyy.MM.dd"));
}

jui.ready([ "chart.builder", "grid.table", "ui.tab", "ui.datepicker", "ui.slider", "ui.dropdown" ],
	function(builder, table, tab, datepicker, slider, dropdown) {

	var month = 2,
		outgoing_chart, outgoing_table, outgoing_datepicker, outgoing_dropdown;

	// To display this month
	printStartToEndDate(month);

	slider("#slider", {
		type: "single",
		from: month + 1,
		min: 1,
		max: 12,
		step: 1,
		tooltip: false,
		event: {
			change: function(d) {
				printStartToEndDate(d.from - 1);
			}
		}
	});

	tab("#tab", {
		event: {
			change: function(data) {
				if(data.index == 0) {
					$("#tab_1").show();
					$("#tab_2").hide();
					$("#tab_3").hide();
				} else if(data.index == 1) {
					$("#tab_1").hide();
					$("#tab_2").show();
					$("#tab_3").hide();
				} else {
					$("#tab_1").hide();
					$("#tab_2").hide();
					$("#tab_3").show();
				}
			}
		}
	});

	outgoing_chart = builder("#outgoing_chart", {
		width : "100%",
		height : 300,
		padding : {
			top : 25,
			right : 25,
			bottom: 25
		},
		axis : [{
			x : {
				type : "block",
				domain : OUTGOING_TYPES
			},
			y : {
				type : "range",
				domain : function(d) {
					return Math.max(d.card, d.cash) * 1.2;
				},
				format : function(d) {
					return Math.floor(d / 1000) + "K";
				},
				step : 3,
				line : "solid"
			},
			data : getOutgoingDataForChart(outgoing_data)
		}],
		brush : [{
			type : "column",
			target : [ "cash", "card" ],
			outerPadding : 25,
			minSize : 5
		}],
		widget : [{
			type : "tooltip"
		}],
		style : {
			gridXAxisBorderWidth : 1,
			gridYAxisBorderWidth : 0,
			gridTickBorderSize : 0,
			gridTickPadding : 7
		}
	});

	outgoing_datepicker = datepicker("#outgoing_datepicker", {
		format: "yyyy/MM/dd",
		event: {
			select: function(date, e) {
				$($(outgoing_table.root).find("input.edit").get(0)).val(date);
				$(this.root).hide();
			}
		},
		tpl: {
			date: "<td><!= date !></td>"
		}
	});

	outgoing_dropdown = dropdown("#outgoing_dropdown", {
		nodes: getOutgoingTypes(),
		event: {
			change: function(data) {
				$($(outgoing_table.root).find("input.edit").get(4)).val(data.value);
				$(this.root).hide();
			}
		},
		tpl : {
			node : "<li value='<!= value !>'><!= text !></li>"
		}
	});

	outgoing_table = table("#outgoing_table", {
		fields : [ null, "date", "memo", "cash", "card", "type" ],
		editRow : true,
		resize : true,
		scroll : true,
		scrollHeight : 240,
		sort : [ 1, 2, 3, 4 ],
		data : outgoing_data,
		event: {
			editstart: function(row, e) {
				var $input = $(row.element).find("input.edit"),
					target = $(e.target).find("input.edit")[0];

				// Set datepicker event
				$($input.get(0)).on("focus", function(e) {
					var offset = $(e.target).offset();

					$(outgoing_datepicker.root).css({
						left: offset.left,
						top: offset.top - 150
					}).show();
				});

				// Set dropdown event
				$($input.get(4)).on("focus", function(e) {
					var offset = $(e.target).offset();

					outgoing_dropdown.show(offset.left, offset.top - 190);
				});

				// Show components
				if(target == $input.get(0)) {
					$($input.get(0)).trigger("focus", e);
				} else if(target == $input.get(4)) {
					$($input.get(4)).trigger("focus", e);
				}
			},
			editend: function(row, e) {
				// Validation check
				if(row.data["date"] == "" || row.data["memo"] == "" ||
					isNaN(row.data["cash"]) || isNaN(row.data["card"]) || isNaN(row.data["type"])) {
					alert("Please enter the correct value.");

					return false;
				}

				outgoing_chart.axis(0).update(getOutgoingDataForChart(this.listData()));
				$(outgoing_datepicker.root).hide();
			}
		}
	});

	table("#table_income", {
		fields : [ null, "date", "memo", "cash", "type" ],
		resize : true,
		sort : [ 1, 2, 3 ],
		data : income_data
	});

	datepicker("#datepicker", {
		format: "yyyy-MM-dd",
		event: {
			select: function(date, e) {
				alert(date);
			}
		},
		tpl: {
			date: $("#tpl_date").html()
		}
	});
});
</script>
</head>
<body class="jui">

<div class="header">
	<div class="center">
		<div class="title">
			<span class="start-date"></span> - <span class="end-date"></span>
		</div>

		<div id="slider" class="slider horizontal" style="width: 250px;"></div>

		<div class="slider-scale">
			<span>1</span>
			<span>2</span>
			<span>3</span>
			<span>4</span>
			<span>5</span>
			<span>6</span>
			<span>7</span>
			<span>8</span>
			<span>9</span>
			<span>10</span>
			<span>11</span>
			<span>12</span>
		</div>
	</div>

	<ul id="tab" class="tab top">
		<li><a href="#">Outgoing</a></li>
		<li><a href="#">Income</a></li>
		<li><a href="#">Calender</a></li>
	</ul>

	<div class="toolbar">
		<div class="group">
			<a class="btn mini"><i class="icon-table"></i></a>
			<a class="btn mini"><i class="icon-tool"></i></a>
			<a class="btn mini"><i class="icon-printer"></i></a>
		</div>
		<a class="btn mini">Add Item</a>
	</div>
</div>

<div class="contents">
	<div id="tab_1">
		<div id="outgoing_chart"></div>

		<table id="outgoing_table" class="table simple headline small stripeless" style="margin-top: 15px;">
			<thead>
			<tr>
				<th width="15"><input type="checkbox" /></th>
				<th width="190">Date</th>
				<th width="40%">Memo</th>
				<th>Cash</th>
				<th>Card</th>
				<th width="190">Type</th>
			</tr>
			</thead>
			<tbody></tbody>
		</table>

		<script data-jui="#outgoing_table" data-tpl="row" type="text/template">
			<tr>
				<td><input type="checkbox" /></td>
				<td><!= date !></td>
				<td><!= memo !></td>
				<td align="right"><!= cash !></td>
				<td align="right"><!= card !></td>
				<td><!= (type === "") ? "" : OUTGOING_TYPES[type] !></td>
			</tr>
		</script>

		<div id="outgoing_datepicker" class="datepicker" style="display: none; position: absolute;">
			<div class="head">
				<div class="prev"><i class="icon-chevron-left"></i></div>
				<div class="title"></div>
				<div class="next"><i class="icon-chevron-right"></i></div>
			</div>
			<table class="body">
				<tr>
					<th>SU</th><th>MO</th><th>TU</th><th>WE</th><th>TH</th><th>FR</th><th>SA</th>
				</tr>
			</table>
		</div>

		<div id="outgoing_dropdown" class="dropdown">
			<ul style="width: 190px;"></ul>
		</div>
	</div>
	<div id="tab_2" style="display: none;">
		<table id="table_income" class="table simple headline small stripeless" style="margin-top: 15px;">
			<thead>
			<tr>
				<th width="15"><input type="checkbox" /></th>
				<th>Date</th>
				<th>Memo</th>
				<th>Income</th>
				<th>Type</th>
			</tr>
			</thead>
			<tbody></tbody>
		</table>

		<script data-jui="#table_income" data-tpl="row" type="text/template">
			<tr>
				<td><input type="checkbox" /></td>
				<td><!= date !></td>
				<td><!= memo !></td>
				<td align="right"><!= cash !></td>
				<td><!= (type === "") ? "" : INCOME_TYPES[type] !></td>
			</tr>
		</script>
	</div>
	<div id="tab_3" style="display: none;">
		<div id="datepicker" class="calendar" style="height: 580px; padding-top: 0px;">
			<table class="body">
				<tr>
					<th>SUN</th><th>MON</th><th>TUE</th><th>WED</th><th>THU</th><th>FRI</th><th>SAT</th>
				</tr>
			</table>
		</div>

		<script id="tpl_date" type="text/template">
			<td>
				<! if(type != "none") { !>
				<! if(day == 0) { !>
				<span style="color: red;"><!= date !></span>
				<! } else if(day == 6) { !>
				<span style="color: blue;"><!= date !></span>
				<! } else { !>
				<span><!= date !></span>
				<! } !>
				<! } !>
			</td>
		</script>
	</div>
</div>


</body>
</html>
