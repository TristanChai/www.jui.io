<!DOCTYPE HTML>
<html>
<head>
<META charset="UTF-8">
<meta name="viewport" content="initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="../../lib/jui/css/ui.min.css" />
<link rel="stylesheet" href="../../lib/jui/css/ui-jennifer.min.css" id="ui_theme" />
<script type="text/javascript" src="../../lib/jquery-1.8.0.min.js" ></script>
<script type="text/javascript" src="../../lib/jui/js/core.js" ></script>
<script type="text/javascript" src="../../lib/jui/js/ui.min.js" ></script>
<script type="text/javascript" src="../../lib/jui/js/chart.js" ></script>
<script type="text/javascript" src="data.js" ></script>
<link rel="stylesheet" href="index.css" />

<script>

(function initData() {
	for(var i = 0, len = data.length; i < len; i++) {
		var d = data[i];

		d.date = new Date(d.date);
		d.month = d.date.getMonth(); // pre-calculate month for better performance
		d.close = +d.close; // coerce to number
		d.open = +d.open;
	}
})();

function getVolumeData() {
	var nd = [],
		total = 0;

	for(var i = 0, len = data.length; i < len; i++) {
		var d = data[i],
			move = (d.open + d.close) / 2,
			days = i + 1;

		total += move;

		nd.push({
			date: d.date,
			days: days,
			move: move,
			avg: Math.round(total / days)
		});
	}

	return nd;
}

jui.ready([ "util.base", "util.time", "chart.builder" ], function(_, time, builder) {
	var volumeData = getVolumeData();

	var volumeChart = builder("#monthly_index", {
		padding : {
			bottom : 90
		},
		width : 1024,
		height : 300,
		axis : [{
			x : {
				type : "date",
				domain : [ volumeData[0].date, volumeData[volumeData.length - 1].date ],
				interval : time.DAY * 365,
				format : "yyyy",
				key : "date",
				line : true
			},
			y : {
				type : "range",
				domain: [ 0, 2000 ],
				step : 4,
				line : false,
				color : 2
			},
			start : 2000,
			end : 3000
		}, {
			extend : 0,
			x : {
				hide : true
			},
			y : {
				type : "range",
				domain: [ 0, 7000 ],
				step : 7,
				line : false,
				orient : "right",
				color : 0
			}
		}],
		brush : [{
			type : "area",
			line : true,
			target : [ "avg" ],
			colors : [ 2 ],
			axis : 0
		}, {
			type : "area",
			line : true,
			target : [ "move" ],
			axis : 1
		}],
		widget : [{
			type : "zoomscroll",
			key : "move",
			dy : 30,
			format : function(d, i) {
				return time.format(d, "yyyy");
			},
			axis : 1
		}],
		event : {
			"zoomscroll.dragend": function(start, end) {
				var domain = {
					domain: [ volumeData[start].date, volumeData[end].date ]
				};

				this.axis(0).set("x", domain);
				this.axis(1).set("x", domain);
			}
		},
		style : {
			areaBackgroundOpacity : 0.75
		},
		render : false
	});

	volumeChart.axis(0).update(volumeData);
	volumeChart.axis(1).update(volumeData);
	volumeChart.render(true);
});
</script>
</head>
<body class="jui">

<div class="row">
    <div id="monthly_index"></div>
</div>

</body>
</html>
